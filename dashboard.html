<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RL Decision Brain - Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: #e2e8f0; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .status { display: inline-block; padding: 6px 12px; background: #10b981; border-radius: 20px; font-size: 14px; font-weight: bold; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: #1e293b; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .card h3 { color: #94a3b8; font-size: 14px; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px; }
        .metric { font-size: 36px; font-weight: bold; color: #fff; margin-bottom: 5px; }
        .label { color: #64748b; font-size: 14px; }
        .action-scope { display: flex; flex-direction: column; gap: 10px; }
        .env-scope { background: #334155; padding: 15px; border-radius: 8px; }
        .env-scope h4 { color: #f1f5f9; margin-bottom: 8px; font-size: 16px; }
        .actions { display: flex; flex-wrap: wrap; gap: 8px; }
        .action-tag { background: #475569; padding: 6px 12px; border-radius: 6px; font-size: 13px; color: #e2e8f0; }
        .test-panel { background: #1e293b; padding: 25px; border-radius: 12px; margin-bottom: 30px; }
        .test-form { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 15px; margin-bottom: 20px; }
        select, input, button { padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: #e2e8f0; font-size: 14px; }
        button { background: #667eea; color: white; cursor: pointer; font-weight: bold; border: none; transition: all 0.3s; }
        button:hover { background: #5568d3; transform: translateY(-2px); }
        .response { background: #0f172a; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; }
        .response pre { color: #94a3b8; font-size: 13px; overflow-x: auto; }
        .decisions-log { background: #1e293b; padding: 25px; border-radius: 12px; }
        .decision-item { background: #0f172a; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #10b981; }
        .decision-item.noop { border-left-color: #64748b; }
        .decision-item.scale_up { border-left-color: #3b82f6; }
        .decision-item.scale_down { border-left-color: #f59e0b; }
        .decision-item.restart { border-left-color: #ef4444; }
        .decision-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .decision-action { font-weight: bold; font-size: 16px; }
        .decision-time { color: #64748b; font-size: 12px; }
        .decision-details { color: #94a3b8; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† RL Decision Brain Dashboard</h1>
            <span class="status" id="status">‚óè HEALTHY</span>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Total Decisions</h3>
                <div class="metric" id="totalDecisions">0</div>
                <div class="label">Since page load</div>
            </div>
            <div class="card">
                <h3>Last Action</h3>
                <div class="metric" id="lastAction">-</div>
                <div class="label">Most recent decision</div>
            </div>
            <div class="card">
                <h3>Demo Status</h3>
                <div class="metric" id="demoStatus">FROZEN</div>
                <div class="label">Learning disabled</div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Action Scope</h3>
                <div class="action-scope">
                    <div class="env-scope">
                        <h4>DEV</h4>
                        <div class="actions">
                            <span class="action-tag">noop</span>
                            <span class="action-tag">scale_up</span>
                            <span class="action-tag">scale_down</span>
                            <span class="action-tag">restart</span>
                        </div>
                    </div>
                    <div class="env-scope">
                        <h4>STAGE</h4>
                        <div class="actions">
                            <span class="action-tag">noop</span>
                            <span class="action-tag">scale_up</span>
                            <span class="action-tag">scale_down</span>
                        </div>
                    </div>
                    <div class="env-scope">
                        <h4>PROD</h4>
                        <div class="actions">
                            <span class="action-tag">noop</span>
                            <span class="action-tag">restart</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-panel">
            <h3 style="color: #94a3b8; margin-bottom: 20px;">üß™ TEST DECISION MAKER</h3>
            <div class="test-form">
                <select id="environment">
                    <option value="dev">DEV</option>
                    <option value="stage">STAGE</option>
                    <option value="prod">PROD</option>
                </select>
                <select id="eventType">
                    <option value="high_cpu">High CPU</option>
                    <option value="high_memory">High Memory</option>
                    <option value="crash">Crash</option>
                    <option value="low_load">Low Load</option>
                </select>
                <input type="number" id="cpuPercent" placeholder="CPU %" value="85" min="0" max="100">
                <button onclick="makeDecision()">üöÄ Get Decision</button>
            </div>
            <div class="response" id="response" style="display: none;">
                <pre id="responseText"></pre>
            </div>
        </div>

        <div class="decisions-log">
            <h3 style="color: #94a3b8; margin-bottom: 20px;">üìä RECENT DECISIONS</h3>
            <div id="decisionsLog"></div>
        </div>
    </div>

    <script>
        let decisionCount = 0;
        const API_BASE = window.location.origin;

        async function checkHealth() {
            try {
                const res = await fetch(`${API_BASE}/health`);
                const data = await res.json();
                document.getElementById('status').textContent = data.status === 'healthy' ? '‚óè HEALTHY' : '‚óè ERROR';
                document.getElementById('status').style.background = data.status === 'healthy' ? '#10b981' : '#ef4444';
                document.getElementById('demoStatus').textContent = data.demo_frozen ? 'FROZEN' : 'ACTIVE';
            } catch (e) {
                document.getElementById('status').textContent = '‚óè OFFLINE';
                document.getElementById('status').style.background = '#ef4444';
            }
        }

        async function makeDecision() {
            const env = document.getElementById('environment').value;
            const eventType = document.getElementById('eventType').value;
            const cpu = document.getElementById('cpuPercent').value;

            const payload = {
                environment: env,
                event_type: eventType,
                metrics: {
                    cpu_percent: parseFloat(cpu),
                    memory_percent: 50.0,
                    error_rate: 0.01
                }
            };

            try {
                const res = await fetch(`${API_BASE}/decide`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();

                document.getElementById('response').style.display = 'block';
                document.getElementById('responseText').textContent = JSON.stringify(data, null, 2);

                decisionCount++;
                document.getElementById('totalDecisions').textContent = decisionCount;
                document.getElementById('lastAction').textContent = data.action.toUpperCase();

                addDecisionToLog(data);
            } catch (e) {
                document.getElementById('response').style.display = 'block';
                document.getElementById('responseText').textContent = `Error: ${e.message}`;
            }
        }

        function addDecisionToLog(data) {
            const log = document.getElementById('decisionsLog');
            const item = document.createElement('div');
            item.className = `decision-item ${data.action}`;
            
            const time = new Date(data.timestamp * 1000).toLocaleTimeString();
            
            item.innerHTML = `
                <div class="decision-header">
                    <span class="decision-action">${data.action.toUpperCase()}</span>
                    <span class="decision-time">${time}</span>
                </div>
                <div class="decision-details">
                    ${data.environment.toUpperCase()} | ${data.reason}
                    ${data.safety_filtered ? ' | ‚ö†Ô∏è SAFETY FILTERED' : ''}
                </div>
            `;
            
            log.insertBefore(item, log.firstChild);
            
            if (log.children.length > 10) {
                log.removeChild(log.lastChild);
            }
        }

        checkHealth();
        setInterval(checkHealth, 5000);
    </script>
</body>
</html>
